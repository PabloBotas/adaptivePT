#TODOs by 2015. Nov. 12: 
#  - Where TableTopRoll/Pitch values go
#  - Beam angular spread is set zero by now
#  - 
###################################################
#----------------- IncludeFiles  ------------------
# Beam describing chain
# Beam control chain from RT-Ion Plan
# Target describing chain
# Target scoring 
###################################################
includeFile = MCAUTO_DICOM.txt
includeFile = MCAUTO_DICOM_SEQUENCE.txt

i:Ts/MaxInterruptedHistories = 200
#In LSF, impt_beam.in include impot_beam.txt + 
#NumberOfThreads + Seed, geant4 version string etc
#i:Ts/NumberOfThreads =3
#sv:Ph/Default/LayeredMassGeometryWorlds = 3 "RangeShifter" "Aperture" "Compensator"

###################################################
#----------------- World volume  ------------------
###################################################
Ge/World/HLX = 40.0 cm
Ge/World/HLY = 40.0 cm
Ge/World/HLZ = 50.0 cm
Ge/World/Material = "Air"

###################################################
#----------------- Coordination  ------------------
###################################################
#IEC_F: Fixed
s:Ge/IEC_F/Parent  = "World"
s:Ge/IEC_F/Type    = "Group"
d:Ge/IEC_F/RotX    = 0. deg
d:Ge/IEC_F/RotY    = 0. deg
d:Ge/IEC_F/RotZ    = 0. deg
d:Ge/IEC_F/TransX  = 0. m
d:Ge/IEC_F/TransY  = 0. m
d:Ge/IEC_F/TransZ  = 0. m

#IEC_G: Gantry
s:Ge/IEC_G/Parent  = "IEC_F"
s:Ge/IEC_G/Type    = "Group"
d:Ge/IEC_G/RotX    = 0. deg 
d:Ge/IEC_G/RotY    = -1.0 * Ge/Gantry_Angle deg
d:Ge/IEC_G/RotZ    = 0. deg
d:Ge/IEC_G/TransX  = 0. m
d:Ge/IEC_G/TransY  = 0. m
d:Ge/IEC_G/TransZ  = 0. m

#S: Patient support
s:Ge/IEC_S/Parent  = "IEC_F"
s:Ge/IEC_S/Type    = "Group"
d:Ge/IEC_S/RotX    = 0. deg
d:Ge/IEC_S/RotY    = 0. deg
d:Ge/IEC_S/RotZ    = Ge/Couch_Angle deg
d:Ge/IEC_S/TransX  = 0. m
d:Ge/IEC_S/TransY  = 0. m
d:Ge/IEC_S/TransZ  = 0. m

#E: Table top ecentric rotation
s:Ge/IEC_E/Parent  = "IEC_S"
s:Ge/IEC_E/Type    = "Group"
d:Ge/IEC_E/RotX    = 0. deg
d:Ge/IEC_E/RotY    = 0. deg
d:Ge/IEC_E/RotZ    = 0. deg
d:Ge/IEC_E/TransX  = 0. m
d:Ge/IEC_E/TransY  = 0. m
d:Ge/IEC_E/TransZ  = 0. m

#T: Table top
#where these two go IEC_E or IEC_T?
s:Ge/IEC_T/Parent  = "IEC_E"
s:Ge/IEC_T/Type    = "Group"
d:Ge/IEC_T/RotX    = 0. deg
d:Ge/IEC_T/RotY    = 0. deg
d:Ge/IEC_T/RotZ    = 0. deg
d:Ge/IEC_T/TransX  = 0. m
d:Ge/IEC_T/TransY  = 0. m
d:Ge/IEC_T/TransZ  = 0. m


####################################################
#----------------- Gantry --------------------------
####################################################
#for plan
d:Ge/Gantry_Angle  = Rt/beam/Gantry deg


####################################################
### RangeShifter/Aperture/Compensator become a mass 
### geometry for only patient calclation
### 1.15 is from Astroid Database
#####################################################
sv:Ma/RS_Lucite/Components =3 "Hydrogen" "Carbon" "Oxygen"
uv:Ma/RS_Lucite/Fractions  =3 0.080538 0.599848 0.319614
d:Ma/RS_Lucite/Density     =1.15 g/cm3
d:Ma/RS_Lucite/MeanExcitationEnergy=74.0 eV
s:Ma/RS_Lucite/DefaultColor="grey"

#3     G4_PLEXIGLASS              1.19              74
#             1     0.080538
#             6     0.599848
#             8     0.319614

###################################################
#----------------- Range Shifter ------------------
###################################################
# Range Shifter
# !!!! check PMMA material at the end
# !!!! Lucite ~= PMMA ~= G4_PLEXIGLASS : density: 1.4, Iev = 74.0 eV
s:Ge/RangeShifter/Type       = "TsBox" #for TOPAS 3.0
s:Ge/RangeShifter/Parent     = "IEC_G"
s:Ge/RangeShifter/Material   = "RS_Lucite"
d:Ge/RangeShifter/HLX        = 15.0 cm 
d:Ge/RangeShifter/HLY        = 15.0 cm 
d:Ge/RangeShifter/HLZ        = Rt/beam/RangeShifterThickness mm  * 0.5
d:Ge/RangeShifter/TransX     = 0.0  cm
d:Ge/RangeShifter/TransY     = 0.0  cm
d:Ge/RangeShifter/TransZ     = Rt/beam/IsocenterToRangeShifterTrayDistance + Ge/RangeShifter/HLZ mm
d:Ge/RangeShifter/RotX       = 0.0 deg
d:Ge/RangeShifter/RotY       = 0.0 deg
d:Ge/RangeShifter/RotZ       = 0.0 deg
s:Ge/RangeShifter/Color      = "skyblue"
b:Ge/RangeShifter/Include    = Rt/beam/IncludeRangeShifter
#b:Ge/RangeShifter/IsParallel = Rt/beam/IncludeRangeShifter

###################################################
#----------------- Aperture     ------------------
###################################################
s:Ge/Aperture/Type        = "TsAperture"
s:Ge/Aperture/Parent      = "IEC_G"
s:Ge/Aperture/Material    = "Brass"
d:Ge/Aperture/RMax        = 15.0 cm
d:Ge/Aperture/HL          = 0.5 * Rt/beam/BlockThickness mm
d:Ge/Aperture/TransX      = 0.0 cm
d:Ge/Aperture/TransY      = 0.0 cm
d:Ge/Aperture/TransZ      = Rt/beam/IsocenterToBlockTrayDistance + Ge/Aperture/HL cm
d:Ge/Aperture/RotX        = 0.0  deg
d:Ge/Aperture/RotY        = 0.0  deg
d:Ge/Aperture/RotZ        = 0.0  deg
s:Ge/Aperture/InputFile   = Rt/beam/ApertureFile 
s:Ge/Aperture/FileFormat  = "XYCoordinates"
b:Ge/Aperture/PrintPoints = "True"
b:Ge/Aperture/Include     = Rt/beam/IncludeAperture
#b:Ge/Aperture/IsParallel  = Rt/beam/IncludeAperture

###################################################
#----------------- Compensator   ------------------
###################################################
s:Ge/Compensator/Type        = "TsCompensator"
s:Ge/Compensator/Parent      = "World"
s:Ge/Compensator/Material    = "RS_Lucite"
d:Ge/Compensator/RMax        = 10.0 cm
dc:Ge/Compensator/Thickness  = 0.0 cm
d:Ge/Compensator/TransX      = 0.0 cm
d:Ge/Compensator/TransY      = 0.0 cm
d:Ge/Compensator/TransZ      = Rt/beam/IsocenterToCompensatorTrayDistance + Ge/Compensator/Thickness cm 
d:Ge/Compensator/RotX        =   0.0  deg
d:Ge/Compensator/RotY        = 180.0  deg #because of beam dir
d:Ge/Compensator/RotZ        = -90.0  deg #because of beam dir
s:Ge/Compensator/InputFile   = Rt/Beam/CompensatorFile
s:Ge/Compensator/FileFormat  = "RowsAndDepths"
s:Ge/Compensator/Method      = "ExtrudedSolid"
b:Ge/Compensator/PrintPoints = "F"
b:Ge/Compensator/Include     = Rt/beam/IncludeCompensator
#b:Ge/Compensator/IsParallel  = Rt/beam/IncludeCompensator


####################################################
#----------------- Couch --------------------------
####################################################
d:Ge/Couch_Angle = Rt/beam/PatientSupportAngle deg

####################################################
#----------------- Table top -----------------------
####################################################
#Ge/TableTop_Pitch_Angle = Rt/beam/TableTopRoll deg
#Ge/TableTop_Roll_Angle  = Rt/beam/TableTopPitch deg 
#How to use it?
d:Ge/TableTop_Pitch_Angle = Rt/beam/TableTopRoll deg 
d:Ge/TableTop_Roll_Angle  = Rt/beam/TableTopPitch deg

###################################################
#----------------- Time line  ------------------
###################################################
Tf/NumberOfSequentialTimes = Sq/SpotControlPoints 
Tf/TimeLineStart           = Sq/IrradiationStartTime s 
Tf/TimeLineEnd             = Sq/IrradiationEndTime   s 

####################################################
#------------------- Spot coordination -------------
# - Beam flies 0 to +z. Y rotation 180 deg
####################################################
s:Ge/BeamSpot/Type    = "Group"
s:Ge/BeamSpot/Parent  = "IEC_G"
#
d:Ge/BeamSpot/TransX  = Tf/spots/SpotPosX_TF/Value mm
d:Ge/BeamSpot/TransY  = Tf/spots/SpotPosY_TF/Value mm
d:Ge/BeamSpot/TransZ  = Rt/beam/IsocenterToBeamDistance cm
#Rotate spot coordination
d:Ge/BeamSpot/RotX    = -1.0 * Tf/spots/SpotDirY_TF/Value rad
d:Ge/BeamSpot/RotY    = 180.0 deg + Tf/spots/SpotDirX_TF/Value
d:Ge/BeamSpot/RotZ    = 0. deg

####################################################
#----------------- Spot properties -----------------
# 
####################################################
#-- Type
s:So/Spot/Type           = "Beam"
s:So/Spot/Component		 = "BeamSpot"
s:So/Spot/BeamShape      = "ellipse"
s:So/Spot/BeamParticle	 = "proton"
s:So/Spot/BeamXYDistribution     = "gaussian"

#-- Spot size
#-- X,Y position sampled out-of 4 will not be used
d:So/Spot/BeamHWX                = Tf/layers/SpotSizeX_TF/Value mm * 4.0 
d:So/Spot/BeamHWY                = Tf/layers/SpotSizeY_TF/Value mm * 4.0 
#-- Spot spread
d:So/Spot/BeamStandardDeviationX = Tf/layers/SpotSizeX_TF/Value mm  
d:So/Spot/BeamStandardDeviationY = Tf/layers/SpotSizeY_TF/Value mm
d:So/Spot/BeamAngularSpreadX = Tf/layers/SpotDivergenceX_TF/Value rad 
d:So/Spot/BeamAngularSpreadY = Tf/layers/SpotDivergenceY_TF/Value rad 
 
#-- Energy
d:So/Spot/BeamEnergy             = Tf/layers/Layer_E_TF/Value MeV 
u:So/Spot/BeamEnergySpread       = Tf/layers/Layer_dE_TF/Value 
i:So/Spot/NumberOfHistoriesInRun = 1 * Tf/spots/NbOfHistoriesPerSpot/Value

#Default defined
i:Ts/ShowHistoryCountAtInterval = 10000
b:Ts/ShowCPUTime = "true"
